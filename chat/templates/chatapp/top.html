{% extends "chatapp/base.html" %}
{% block content %}
{% load static %}
<link rel="stylesheet" type="text/css" href="{% static 'css/top.css' %}">
<div id="mySidebar" class="sidebar">
    <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
    <div class="row room_group_name">
      <div class="col-12">
          <p>トークルーム一覧</p>
      </div>
    </div>
   {% if my_rooms %}
    {% for room in my_rooms %}
      <div class="chat_list active_chat" room_id="{{ room.room.pk }}">
        <div class="row chat_people">
          <div class="col-3 chat_img">
            <img class="img img-thumbnail" src="{{ room.opponent.user.thumbnail_url }}" alt="sunil">
          </div>
          <div class="col-9 chat_ib">
            <div class="row">
              <div class="col-7">
                  <p class="room_title">{{ room.room.title }}</p>
              </div>
              <div class="col-5" style="text-align: right">
                  <p class="chat_date">{{ room.room.get_latest_message.sent_at|date:"n/j G:i" }}</p>
              </div>        
            </div>
            <div class="row">
              <div class="col-8">
                  <p class="room_latest_message">{{ room.room.get_latest_message.caption }}</p>
              </div>
              <div class="col-4">
                  <button room_id="{{ room.room.pk }}" type="button" class="btn btn-primary btn-sm btn-block" name="room_btn"><i class="fas fa-comments"></i> Chat</button>
              </div>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
      {% else %}
        <p>参加中のルームはありません</p>
      {% endif %}
  </div>
<div class="container">
  <button class="openbtn btn btn-primary" onclick="openNav()">&#9776; チャットルームを表示</button>  
  <div id="main" class="messaging">
      <div class="inbox_msg" style="display: none">
        <div class="mesgs">
          <div class="msg_history">
            <!-- MESSAGE TO BE ADDED HERE -->
          </div>
          <div id="message_form" class="type_msg">
              <div class="input-group">
                <textarea rows="1" id="chat-message-input" class="form-control" placeholder="message here.."></textarea>
                <form name="file_upload">
                  <div class="input-group-append">
                    <button name="fileupload" class="btn file_attach_btn" type="button">
                      <i class="fas fa-paperclip white-icon"></i>
                    </button>
                  </div>
                  
                  <input id="fileupload" type="file" name="attachment" multiple style="display:none"
                              data-url="{% url 'chatapp:upload' %}"
                              data-form-data='{"csrfmiddlewaretoken": "{{ csrf_token }}"}'>
                </form>
                <div class="input-group-append">
                  <button id="send_msg_button" class="btn message_btn" type="submit">
                    <i class="fab fa-telegram-plane white-icon"></i>
                  </button>
                </div>
                
              </div>
              <div id="preview_zone" class="row">

              </div>
          </div>
        </div>
      </div>
  </div>     
</div>
{% endblock %}
{% block extra_js %}

<script>
    var history_url = "{% url 'chatapp:history' %}";
    var login_url = "{% url 'chatapp:login' %}";
    var attachment_url = "{% url 'chatapp:upload' %}";
    var user_pk = '{{ user.pk }}';

    function openNav() {
      document.getElementById("mySidebar").style.width = "375px";
      document.getElementById("main").style.marginLeft = "375px";
    }

    /* Set the width of the sidebar to 0 and the left margin of the page content to 0 */
    function closeNav() {
      document.getElementById("mySidebar").style.width = "0";
      document.getElementById("main").style.marginLeft = "0";
    }
    
</script>
<script src="{% static 'js/top.js' %}"></script>
{% endblock %}
